#TouhouDanmakufu[Single]
#ScriptVersion[3]
#Title["Peach Basic Pattern 1"]
#Text["TESTING BASIC PATTERN 1"]
#Background["script/Peach/Peach Background.txt"]
// REMOVE HEADER ONCE DONE TESTING
// A simple basic spell card by Peach utilizing ? and ? to get the player comfortable.

#include "../ZUNShot/ZUNShot_Const.txt"
#include "./[library] boss.txt"

let se = scriptDir ~ "se_tan00.wav";

let bossObj;
let bossX = 0;
let bossY = 0;

// Instead of using the default bullets, I will use a custom bullet.

@Initialize {
	bossObj = ObjEnemy_Create(OBJ_ENEMY_BOSS);
	ObjEnemy_Regist(bossObj);
	ObjMove_SetDestAtFrame(bossObj, GetStgFrameWidth() / 2, 120, 60);
	LoadSound(se);
	
	TRenderBoss;
	TFireLoop;
	TMovement;
}

@Event {
	alternative(GetEventType())
	case (EV_REQUEST_LIFE) {
		SetScriptResult(800);
	}
	
	case (EV_REQUEST_TIMER) {
		SetScriptResult(60);
	}
	
}

@MainLoop {
	bossX = ObjMove_GetX(bossObj);
	bossY = ObjMove_GetY(bossObj);
	
	ObjEnemy_SetIntersectionCircleToShot(bossObj, bossX, bossY, 24);
	ObjEnemy_SetIntersectionCircleToPlayer(bossObj, bossX, bossY, 32);
	
	yield;
}

@Finalize {

}

// ===== Functions =====

function wait(w) {
	loop(w) {
		yield;
	}
}

// ===== Tasks ======

task TFireLoop {
	wait(70);
	while (!Obj_IsDeleted(bossObj) {
		TFire(1, 0, 92);
		PlaySE(se);
		wait(18);
		TFire(2, 90, 96);
		wait(18);
		TFire(1, 90, 92);
		PlaySE(se);
		wait(18);
		TFire(2, 0, 96);
		wait(18);
	}
}

task TMovement {
	loop {
		wait(120);
		ObjMove_SetDestAtSpeed(bossObj, rand(0, GetStgFrameWidth()), rand(40, 120), 1);
	}
}

task TFire(speed, angle, shotID){
	loop(30) { // Loop and angle divisor determines amount of bullets fired in the circle formation
		CreateShotA1(bossX + cos(angle), bossY + sin(angle), speed, angle, shotID, 1);
		angle += 360/30;
	}
}